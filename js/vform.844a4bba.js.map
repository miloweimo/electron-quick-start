{"version":3,"sources":["webpack:///./src/modules/vform/index.vue","webpack:///./src/modules/vform/fixed.vue","webpack:///src/modules/vform/fixed.vue","webpack:///./src/modules/vform/fixed.vue?c1ce","webpack:///./src/modules/vform/fixed.vue?633b","webpack:///src/modules/vform/index.vue","webpack:///./src/modules/vform/index.vue?7b83","webpack:///./src/modules/vform/index.vue?715a","webpack:///../../../src/components/VForm/VForm.ts"],"names":["staticClass","staticStyle","_vm","on","$refs","ref","attrs","_c","model","callback","expression","staticRenderFns","value","$event","data","valid","num","text","dataList","name","age","headers","selectedList","computed","list","methods","hanlePush","push","length","handleReset","form","reset","console","log","$nextTick","component","components","fixed","mixins","BindsAttrs","RegistrableProvide","extend","provide","this","inheritAttrs","props","disabled","Boolean","lazyValidation","readonly","inputs","watchers","errorBag","watch","handler","val","errors","Object","values","includes","$emit","deep","immediate","watchInput","input","watcher","$watch","$set","_uid","shouldValidate","hasOwnProperty","validate","filter","forEach","resetErrorBag","setTimeout","resetValidation","register","unregister","found","find","i","unwatch","$delete","render","h","novalidate","attrs$","submit","e","getSlot"],"mappings":"kKAAgG,EAAS,W,IAAoDA,OAA2BC,UAAY,G,OAAC,QAAS,C,YAAY,QAAoB,wDAAE,YAAWC,eAA2FC,YAAG,CAAC,OAAQ,Y,aAA4BC,UAAmB,gGAAE,GAAEF,CAA8BG,MAAU,YAACC,OAAM,wBAAwB,CAACC,EAAG,aAAU,SAAc,CAAEC,IAAK,O,MAAO,CAAYC,kBAASA,K,CAA4B,EAAC,iB,MAACC,CAAiB,aAAIH,SAAU,SAAC,GAAI,UAAsB,qBAA4FD,EAAK,OAAC,C,GAAC,CAAqB,MAAS,EAACJ,YAAe,GAAI,GAAE,sBAAkB,2CAA4D,CACv1B,OACGS,QAAe,SAEnB,QAAiBA,c,0GCJ+E,G,UAAK,W,IAAOX,OAAgCC,UAAY,G,OAAC,QAAS,C,YAAY,QAAoB,UAAE,YAAYM,oBAAYJ,YAAG,CAAC,OAAQD,YAAe,uBAAkCG,GAAI,MAAM,UAACC,IAAO,sBAAsBE,GAAK,GAAC,oB,IAACI,O,MAAkBH,C,kBAAsC,I,MAAEC,CAAkB,cAAIH,SAAS,SAAI,GAAgBC,EAAM,SAAkBC,WAAS,U,CAA4B,EAAC,iB,MAACC,CAAiB,aAAIH,SAAU,SAAC,GAAI,UAAsB,qBAAoKF,EAAI,QAAQC,IAAO,QAAa,Y,CAAqB,KAAO,sBAAS,6G,IAAC,Q,MAAsB,CAAiB,iBAAyB,eAAG,MAAC,OAAC,kB,WAA+CO,MAAM,iBAAC,O,GAA0CX,CAAc,kCAAE,SAAQU,wBAAwB,YAACH,MAAS,I,MAAsCC,CAAyB,qBAAI,SAAS,YAClkC,kBACsCR,WAAQ,mBAAiB,IAAU,OAG1E,EAAiBS,Y,6KC2CF,GACfG,OACA,OACAC,OAAA,EACAC,IAAA,EACAC,KAAA,MACAC,SAAA,CACA,CACAC,KAAA,KACAC,IAAA,IAEA,CACAD,KAAA,KACAC,IAAA,KAGAC,QAAA,CACA,CACAJ,KAAA,KACAL,MAAA,QAEA,CACAK,KAAA,KACAL,MAAA,QAGAU,aAAA,KAGAC,SAAA,CACAC,OACA,eAAAN,YAGAO,QAAA,CACAC,YACA,KAAAR,SAAAS,KAAA,CACAR,KAAA,KAAAF,KACAG,IAAA,QAAAF,SAAAU,UAGAC,cACA,KAAAzB,MAAA0B,KAAAC,QACAC,QAAAC,IAAA,KAAAjB,IAAA,WACA,KAAAkB,UAAA,KACA,KAAAlB,IAAA,QC7F2X,I,YCOvXmB,EAAY,eACd,EACA,EACA,GACA,EACA,KACA,KACA,MAIa,EAAAA,E,QCsBA,GACfC,WAAA,CACAC,SAEAvB,OACA,OACAG,KAAA,MACAC,SAAA,CACA,CACAC,KAAA,KACAC,IAAA,IAEA,CACAD,KAAA,KACAC,IAAA,KAGAC,QAAA,CACA,CACAJ,KAAA,KACAL,MAAA,QAEA,CACAK,KAAA,KACAL,MAAA,UAKAa,QAAA,CACAC,YACA,KAAAR,SAAAS,KAAA,CACAR,KAAA,KAAAF,KACAG,IAAA,QAAAF,SAAAU,YCzE2X,ICOvX,EAAY,eACd,EACA,EACAjB,GACA,EACA,KACA,KACA,MAIa,e,yGCGA2B,sBACbC,OACAC,eAAmB,SAEnBC,OAAO,CACPtB,KAAM,SAENuB,UACE,MAAO,CAAEZ,KAAMa,OAGjBC,cAAc,EAEdC,MAAO,CACLC,SAAUC,QACVC,eAAgBD,QAChBE,SAAUF,QACVnC,MAAOmC,SAGTjC,KAAMA,KAAA,CACJoC,OAAQ,GACRC,SAAU,GACVC,SAAU,KAGZC,MAAO,CACLD,SAAU,CACRE,QAASC,GACP,MAAMC,EAASC,OAAOC,OAAOH,GAAKI,UAAS,GAE3ChB,KAAKiB,MAAM,SAAUJ,IAEvBK,MAAM,EACNC,WAAW,IAIfrC,QAAS,CACPsC,WAAYC,GACV,MAAMC,EAAWD,GACRA,EAAME,OAAO,WAAaX,IAC/BZ,KAAKwB,KAAKxB,KAAKS,SAAUY,EAAMI,KAAMb,IACpC,CAAEO,WAAW,IAGZX,EAAqB,CACzBiB,KAAMJ,EAAMI,KACZrD,MAAOA,OACPsD,eAAgBA,QAiBlB,OAdI1B,KAAKK,eAEPG,EAASkB,eAAiBL,EAAME,OAAO,iBAAmBX,IACnDA,IAGDZ,KAAKS,SAASkB,eAAeN,EAAMI,QAEvCjB,EAASpC,MAAQkD,EAAQD,OAG3Bb,EAASpC,MAAQkD,EAAQD,GAGpBb,GAGToB,WACE,OAAqE,IAA9D5B,KAAKO,OAAOsB,OAAOR,IAAUA,EAAMO,UAAS,IAAO3C,QAG5DG,QACEY,KAAKO,OAAOuB,QAAQT,GAASA,EAAMjC,SACnCY,KAAK+B,iBAEPA,gBACM/B,KAAKK,gBAEP2B,WAAW,KACThC,KAAKS,SAAW,IACf,IAIPwB,kBACEjC,KAAKO,OAAOuB,QAAQT,GAASA,EAAMY,mBACnCjC,KAAK+B,iBAEPG,SAAUb,GACRrB,KAAKO,OAAOvB,KAAKqC,GACjBrB,KAAKQ,SAASxB,KAAKgB,KAAKoB,WAAWC,KAErCc,WAAYd,GACV,MAAMe,EAAQpC,KAAKO,OAAO8B,KAAKC,GAAKA,EAAEb,OAASJ,EAAMI,MAErD,IAAKW,EAAO,OAEZ,MAAMG,EAAUvC,KAAKQ,SAAS6B,KAAKC,GAAKA,EAAEb,OAASW,EAAMX,MACrDc,IACFA,EAAQnE,QACRmE,EAAQb,kBAGV1B,KAAKQ,SAAWR,KAAKQ,SAASqB,OAAOS,GAAKA,EAAEb,OAASW,EAAMX,MAC3DzB,KAAKO,OAASP,KAAKO,OAAOsB,OAAOS,GAAKA,EAAEb,OAASW,EAAMX,MACvDzB,KAAKwC,QAAQxC,KAAKS,SAAU2B,EAAMX,QAItCgB,OAAQC,GACN,OAAOA,EAAE,OAAQ,CACfrF,YAAa,SACbM,MAAO,CACLgF,YAAY,KACT3C,KAAK4C,QAEVpF,GAAI,CACFqF,OAASC,GAAa9C,KAAKiB,MAAM,SAAU6B,KAE5CC,eAAQ/C","file":"js/vform.844a4bba.js","sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"pa-4\"},[_c('h1',[_vm._v(\"测试在v-form下面的v-datatable重置问题\")]),_c('div',{staticClass:\"rounded pa-4\",staticStyle:{\"border\":\"1px solid\",\"min-height\":\"300px\"}},[_c('h2',[_vm._v(\"问题复现: 我复现了这个bug：在v-form中使用v-data-table，重置表单后，push数据到data table无变化；\")]),_c('v-btn',{on:{\"click\":function($event){return _vm.$refs.form.reset()}}},[_vm._v(\" 重置 \")]),_c('v-form',{ref:\"form\",attrs:{\"lazy-validation\":\"\"}},[_c('div',[_c('v-text-field',{model:{value:(_vm.text),callback:function ($$v) {_vm.text=$$v},expression:\"text\"}}),_c('v-btn',{on:{\"click\":_vm.hanlePush}},[_vm._v(\" Push to Table \")])],1),_vm._v(\" \"+_vm._s(_vm.dataList)+\" \"),_c('v-data-table',{attrs:{\"items\":_vm.dataList,\"headers\":_vm.headers}})],1)],1),_c('hr'),_vm._v(\" 是因为，v-form 会重置表单中的所有input输入框，对应的就是v-data-table的每页数量 \"),_c('hr'),_c('fixed')],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"pa-4\"},[_c('div',{staticClass:\"rounded pa-4 mt-4\",staticStyle:{\"border\":\"1px solid\",\"min-height\":\"300px\"}},[_vm._m(0),_c('v-btn',{on:{\"click\":_vm.handleReset}},[_vm._v(\" 重置 \")]),_c('v-form',{ref:\"form\",attrs:{\"lazy-validation\":\"\"},model:{value:(_vm.valid),callback:function ($$v) {_vm.valid=$$v},expression:\"valid\"}},[_c('div',[_c('v-text-field',{model:{value:(_vm.text),callback:function ($$v) {_vm.text=$$v},expression:\"text\"}}),_c('v-btn',{on:{\"click\":_vm.hanlePush}},[_vm._v(\" Push to Table \")])],1),_vm._v(\" dataList:\"+_vm._s(_vm.dataList)+\" \"),_c('hr'),_vm._v(\" selectedList:\"+_vm._s(_vm.selectedList)+\" \"),_c('v-data-table',{ref:\"table\",attrs:{\"show-select\":\"\",\"height\":\"300px\",\"items\":_vm.list,\"headers\":_vm.headers,\"item-key\":\"age\",\"items-per-page\":_vm.num},on:{\"update:itemsPerPage\":function($event){_vm.num=$event},\"update:items-per-page\":function($event){_vm.num=$event}},model:{value:(_vm.selectedList),callback:function ($$v) {_vm.selectedList=$$v},expression:\"selectedList\"}})],1)],1)])\n}\nvar staticRenderFns = [function (){var _vm=this,_c=_vm._self._c;return _c('h2',[_vm._v(\" 解决方案: \"),_c('br'),_vm._v(\" v-form下的v-data-table，:items-per-pag加上.sync； 在重置v-form时，$nextTick重新赋值v-data-table的items-per-page \")])\n}]\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"pa-4\">\n    <div\n      style=\"border: 1px solid;min-height: 300px;\"\n      class=\"rounded pa-4 mt-4\"\n    >\n      <h2>\n        解决方案:\n        <br>\n        v-form下的v-data-table，:items-per-pag加上.sync；\n        在重置v-form时，$nextTick重新赋值v-data-table的items-per-page\n      </h2>\n      <v-btn @click=\"handleReset\">\n        重置\n      </v-btn>\n      <v-form\n        ref=\"form\"\n        v-model=\"valid\"\n        lazy-validation\n      >\n        <div>\n          <v-text-field\n            v-model=\"text\"\n          />\n          <v-btn @click=\"hanlePush\">\n            Push to Table\n          </v-btn>\n        </div>\n        dataList:{{ dataList }}\n        <hr>\n        selectedList:{{ selectedList }}\n        <v-data-table\n          ref=\"table\"\n          v-model=\"selectedList\"\n          show-select\n          height=\"300px\"\n          :items=\"list\"\n          :headers=\"headers\"\n          item-key=\"age\"\n          :items-per-page.sync=\"num\"\n        />\n      </v-form>\n    </div>\n  </div>\n</template>\n\n<script>\n\nexport default {\n  data() {\n    return {\n      valid: true,\n      num: 5,\n      text: '123',\n      dataList: [\n        {\n          name: '张三',\n          age: 18,\n        },\n        {\n          name: '李四',\n          age: 19,\n        }\n      ],\n      headers: [\n        {\n          text: '姓名',\n          value: 'name',\n        },\n        {\n          text: '年龄',\n          value: 'age',\n        },\n      ],\n      selectedList: [],\n    }\n  },\n  computed: {\n    list() {\n      return [ ...this.dataList];\n    },\n  },\n  methods: {\n    hanlePush() {\n      this.dataList.push({\n        name: this.text,\n        age: 20 + this.dataList.length,\n      })\n    },\n    handleReset() {\n      this.$refs.form.reset()\n      console.log(this.num, 'num @@1');\n      this.$nextTick(() => {\n        this.num = 10;\n      })\n    }\n  },\n}\n</script>\n\n<style>\n\n</style>","import mod from \"-!../../../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../../../node_modules/thread-loader/dist/cjs.js!../../../../../node_modules/babel-loader/lib/index.js!../../../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./fixed.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../../../node_modules/thread-loader/dist/cjs.js!../../../../../node_modules/babel-loader/lib/index.js!../../../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./fixed.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./fixed.vue?vue&type=template&id=a524af3c\"\nimport script from \"./fixed.vue?vue&type=script&lang=js\"\nexport * from \"./fixed.vue?vue&type=script&lang=js\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","<template>\n  <div class=\"pa-4\">\n    <h1>测试在v-form下面的v-datatable重置问题</h1>\n    <div\n      style=\"border: 1px solid;min-height: 300px;\"\n      class=\"rounded pa-4\"\n    >\n      <h2>问题复现: 我复现了这个bug：在v-form中使用v-data-table，重置表单后，push数据到data table无变化；</h2>\n      <v-btn @click=\"$refs.form.reset()\">\n        重置\n      </v-btn>\n      <v-form\n        ref=\"form\"\n        lazy-validation\n      >\n        <div>\n          <v-text-field\n            v-model=\"text\"\n          />\n          <v-btn @click=\"hanlePush\">\n            Push to Table\n          </v-btn>\n        </div>\n        {{ dataList }}\n        <v-data-table\n          :items=\"dataList\"\n          :headers=\"headers\"\n        />\n      </v-form>\n    </div>\n    <hr>\n    是因为，v-form 会重置表单中的所有input输入框，对应的就是v-data-table的每页数量\n    <hr>\n    <fixed />\n  </div>\n</template>\n\n<script>\nimport fixed from './fixed.vue'\n\nexport default {\n  components: {\n    fixed,\n  },\n  data() {\n    return {\n      text: '123',\n      dataList: [\n        {\n          name: '张三',\n          age: 18,\n        },\n        {\n          name: '李四',\n          age: 19,\n        }\n      ],\n      headers: [\n        {\n          text: '姓名',\n          value: 'name',\n        },\n        {\n          text: '年龄',\n          value: 'age',\n        },\n      ],\n    }\n  },\n  methods: {\n    hanlePush() {\n      this.dataList.push({\n        name: this.text,\n        age: 20 + this.dataList.length,\n      })\n    },\n  },\n}\n</script>\n\n<style>\n\n</style>","import mod from \"-!../../../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../../../node_modules/thread-loader/dist/cjs.js!../../../../../node_modules/babel-loader/lib/index.js!../../../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../../../node_modules/thread-loader/dist/cjs.js!../../../../../node_modules/babel-loader/lib/index.js!../../../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=139acafd\"\nimport script from \"./index.vue?vue&type=script&lang=js\"\nexport * from \"./index.vue?vue&type=script&lang=js\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","// Components\nimport VInput from '../VInput/VInput'\n\n// Mixins\nimport mixins from '../../util/mixins'\nimport BindsAttrs from '../../mixins/binds-attrs'\nimport { provide as RegistrableProvide } from '../../mixins/registrable'\n\n// Helpers\nimport { VNode } from 'vue'\nimport { getSlot } from '../../util/helpers'\n\ntype ErrorBag = Record<number, boolean>\ntype VInputInstance = InstanceType<typeof VInput>\ntype Watchers = {\n  _uid: number\n  valid: () => void\n  shouldValidate: () => void\n}\n\n/* @vue/component */\nexport default mixins(\n  BindsAttrs,\n  RegistrableProvide('form')\n  /* @vue/component */\n).extend({\n  name: 'v-form',\n\n  provide (): object {\n    return { form: this }\n  },\n\n  inheritAttrs: false,\n\n  props: {\n    disabled: Boolean,\n    lazyValidation: Boolean,\n    readonly: Boolean,\n    value: Boolean,\n  },\n\n  data: () => ({\n    inputs: [] as VInputInstance[],\n    watchers: [] as Watchers[],\n    errorBag: {} as ErrorBag,\n  }),\n\n  watch: {\n    errorBag: {\n      handler (val) {\n        const errors = Object.values(val).includes(true)\n\n        this.$emit('input', !errors)\n      },\n      deep: true,\n      immediate: true,\n    },\n  },\n\n  methods: {\n    watchInput (input: any): Watchers {\n      const watcher = (input: any): (() => void) => {\n        return input.$watch('hasError', (val: boolean) => {\n          this.$set(this.errorBag, input._uid, val)\n        }, { immediate: true })\n      }\n\n      const watchers: Watchers = {\n        _uid: input._uid,\n        valid: () => {},\n        shouldValidate: () => {},\n      }\n\n      if (this.lazyValidation) {\n        // Only start watching inputs if we need to\n        watchers.shouldValidate = input.$watch('shouldValidate', (val: boolean) => {\n          if (!val) return\n\n          // Only watch if we're not already doing it\n          if (this.errorBag.hasOwnProperty(input._uid)) return\n\n          watchers.valid = watcher(input)\n        })\n      } else {\n        watchers.valid = watcher(input)\n      }\n\n      return watchers\n    },\n    /** @public */\n    validate (): boolean {\n      return this.inputs.filter(input => !input.validate(true)).length === 0\n    },\n    /** @public */\n    reset (): void {\n      this.inputs.forEach(input => input.reset())\n      this.resetErrorBag()\n    },\n    resetErrorBag () {\n      if (this.lazyValidation) {\n        // Account for timeout in validatable\n        setTimeout(() => {\n          this.errorBag = {}\n        }, 0)\n      }\n    },\n    /** @public */\n    resetValidation () {\n      this.inputs.forEach(input => input.resetValidation())\n      this.resetErrorBag()\n    },\n    register (input: VInputInstance) {\n      this.inputs.push(input)\n      this.watchers.push(this.watchInput(input))\n    },\n    unregister (input: VInputInstance) {\n      const found = this.inputs.find(i => i._uid === input._uid)\n\n      if (!found) return\n\n      const unwatch = this.watchers.find(i => i._uid === found._uid)\n      if (unwatch) {\n        unwatch.valid()\n        unwatch.shouldValidate()\n      }\n\n      this.watchers = this.watchers.filter(i => i._uid !== found._uid)\n      this.inputs = this.inputs.filter(i => i._uid !== found._uid)\n      this.$delete(this.errorBag, found._uid)\n    },\n  },\n\n  render (h): VNode {\n    return h('form', {\n      staticClass: 'v-form',\n      attrs: {\n        novalidate: true,\n        ...this.attrs$,\n      },\n      on: {\n        submit: (e: Event) => this.$emit('submit', e),\n      },\n    }, getSlot(this))\n  },\n})\n"],"sourceRoot":""}